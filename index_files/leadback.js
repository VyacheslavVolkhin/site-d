!function(){this.inArray=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},this.glob=function(e){for(var t,o=e.split("."),i=window,a=0,n=o.length;a<n;a++)i[t=o[a]]=i[t]||{},i=i[t];return i},glob("ldbck");var e,t,o,i,f=ldbck;if(window._emv){if(window.ldbck_loaded)return f.log("multiple instance detected"),!1;window.ldbck_loaded=!0}if(f.DEBUG=!1,f.ACCEPT_CHATS=!1,f.version="v1.12.27b260525",f.DOMAIN=f.DEBUG?"leadback.local":"string"==typeof _emv.cdn?_emv.cdn:"leadback.ru",f.CHAT_CDN=f.DEBUG?"//cloudim.local/js/":"https://cloudim.ru/js/",f.JQUERY_URL="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js?ldbck_v="+f.version,f.JS_CDN=f.DEBUG?"//"+f.DOMAIN+"/js/":"https://"+f.DOMAIN+"/js/",f.PUBLIC_SERVER=(f.DEBUG?"//":"https://")+f.DOMAIN+"/",f.JQUERY_VERSIONS="3.3.1 3.2.1 3.1.1 2.2.4 2.1.1 1.12.4 1.11.3 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0".split(" "),f.LAST_SPEED=f.LEAVE_POINT=f.LAST_X_POSITION=f.LAST_Y_POSITION=0,f.timer=27e3,f.activity=0,f.clock=null,f.stat={x:null,y:null,s:null,t:0,a:0,l:0},f.total_time=0,f.last_visit_timeout=0,f.visit_date=null,f.Chat={},f.storage=null,f.dom_is_ready=null,f.chat_is_suspended=!1,f.restarted=!1,f.is_multibutton=null,f.$multibutton=null,f.beforeOpenWidget=null,f.successCallCallback=null,f.chat_settings=null,f.form_settings=null,"function"==typeof _emv.successCallCallback&&(f.successCallCallback=_emv.successCallCallback),f.onApiReady=[],"function"==typeof _emv.onApiReady)f.onApiReady.push(_emv.onApiReady);else if("object"==typeof _emv.onApiReady)for(var a=0,n=_emv.onApiReady.length;a<n;a++)"function"==typeof _emv.onApiReady[a]&&f.onApiReady.push(_emv.onApiReady[a]);f.is_vk=_emv.is_vk||!1,f.debug_window=_emv.debug_window||!1;try{f.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),f.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)}catch(e){}h=_emv.campaign,f.cc="__leadback_"+h,f.ct="__leadback_timeout_"+h,f.cg="__leadback_guid_"+h,f.storage_type="cookie",f.countDownInterval=null,f.replacedTags={},f.googleAnaliticEnabled=void 0!==_emv.disableGoogleAnalytics&&!0!==_emv.disableGoogleAnalytics,f.googleAnaliticEnabled&&!f.DEBUG&&(window.GoogleAnalyticsObject||(e=window,i=document,t="script",o="ga",e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=i.createElement(t),i=i.getElementsByTagName(t)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(o,i)),"function"==typeof ga)&&(ga("create","UA-53479583-2","auto",{name:"ldbckTracker"}),ga("ldbckTracker.send","pageview")),f.ga_cid=null,"function"==typeof ga&&ga(function(){f.getGoogleCid()});var l=0,r=setInterval(function(){l++,f.getGoogleCid()?(f.log("Ga cid found",f.getGoogleCid()),r&&(clearInterval(r),r=null)):5<l&&(r&&(clearInterval(r),r=null),f.log("Ga cid not found by interval"))},500),s=(f.getGoogleCid=function(){return null===f.ga_cid&&"function"==typeof ga&&"function"==typeof ga.getAll&&ga.getAll().length&&(f.ga_cid=ga.getAll()[0].get("clientId"),r)&&(clearInterval(r),r=null),f.log("getGoogleCid",f.ga_cid),f.ga_cid},f.ya=[],f.ya_cid=null,f.ya_counter=null,0),c=setInterval(function(){for(var e in s++,window)0==e.indexOf("yaCounter")&&("function"==typeof window[e].getClientID&&null===f.ya_cid&&(f.ya_cid=window[e].getClientID(),f.ya_counter=e.toLowerCase().replace("yacounter",""),f.log("YA CID:"+f.ya_cid),f.log("YA COUNTER:"+f.ya_counter)),"function"==typeof window[e].reachGoal)&&(f.ya[f.ya.length]=e,f.log("Ya: "+f.ya.length));0<f.ya.length?clearInterval(c):5<s&&(clearInterval(c),f.log("Ya not found"))},500);function m(){for(var e=0,t={};e<arguments.length;e++){var o,i=arguments[e];for(o in i)t[o]=i[o]}return t}if(f.init=function(){f.log("init");try{var e=document.location.href,t=-1!==e.indexOf("&_cobrowsing=true")||-1!==e.indexOf("?_cobrowsing=true");if(window!=window.top&&!f.is_vk||t)return f.log("in frame, sending handshake..."),window.top.postMessage("ldbck_forms:"+JSON.stringify({event:"ldbck_wizard_handshake",data:{widget_key:_emv.campaign}}),f.DEBUG?"http://"+f.DOMAIN:"https://"+f.DOMAIN),void window.addEventListener("message",function(e){if("string"!=typeof e.data||-1===e.data.indexOf("ldbck_forms:"))return!1;e=e.data.replace("ldbck_forms:","");"ldbck_wizard_handshake"===JSON.parse(e).event&&(f.log("Wizard form handshake received, loading JS from CDN",f.JS_CDN+"magic_forms_wizard/magic_forms_wizard.js?v="+f.version),f.loadScript(f.JS_CDN+"magic_forms_wizard/magic_forms_wizard.js?v="+f.version,!0,function(){f.log("WIZARD Forms Loaded"),new LeadbackMagicFormsWizard(f.$,f.DEBUG)}))})}catch(e){}f.activity=f.DEBUG?1:f.randomVal(10,20),f.$.ajaxSetup({async:!0}),f.storage_type="local";try{void 0!==f.Cookies.get("__leadback_ver")&&(f.Cookies.remove(f.cc,{path:"/"}),f.Cookies.remove(f.ct,{path:"/"}),f.Cookies.remove("__leadback_ver",{path:"/"}))}catch(e){}return f.log("Storage type is: "+f.storage_type),f.storage=f.initStorage(_emv.campaign),f.initWidget()},f.getStorageType=function(e){var t=f.storage_type;return t=e!=f.cg||f.is_vk?t:"cookie"},f.getCookie=function(e){var t=f.getStorageType(e);return"cookie"==t?f.Cookies.getJSON(e):"local"==t?void 0===(t=f.storage.localStorage.get(e))?t:void 0!==t.expires&&"string"==typeof t.expires&&new Date(t.expires)<new Date?void f.removeCookie(e):t.value:void 0},f.setCookie=function(e,t,o){var i=f.getStorageType(e);return"cookie"==i?f.Cookies.set(e,t,o):"local"==i?(void 0===o.expires&&(o.expires=0),f.storage.localStorage.set(e,{value:t,expires:o.expires})):void 0},f.removeCookie=function(e,t){var o=f.getStorageType(e);return"cookie"==o?f.Cookies.remove(e,t):"local"==o?f.storage.localStorage.remove(e):void 0},f.restart=function(e){return f.restarted=!0,f.unloadWidget(),f.timer=27e3,f.clock=null,f.stat={x:null,y:null,s:null,t:0,a:0,l:0},f.total_time=0,f.last_visit_timeout=0,f.Chat={},f.storage=null,f.dom_is_ready=null,e&&f.restartStorage(e),f.$("#lb_widget-root").remove(),f.initWidget()},f.restartStorage=function(e){_emv.campaign=e,f.cc="__leadback_"+e,f.ct="__leadback_timeout_"+e,f.cg="__leadback_guid_"+e,f.storage=f.initStorage(e)},f.initWidget=function(){f.log("initWidget"),"#demomode"!=window.location.hash&&"#debug"!=window.location.hash||(f.log("Demo mode ON"),f.removeCookie(f.cc,{path:"/"}),f.removeCookie(f.ct,{path:"/"}),void 0!==f.getCookie(f.cg)&&f.setCookie(f.cg,{guid:f.getCookie(f.cg).guid,converted:!1,t:f.getCookie(f.cg).t},{path:"/",expires:99999})),f.visit_date=new Date;function e(){f.$.ajax({type:"GET",url:f.PUBLIC_SERVER+"backend/widget_data.php",dataType:"json",data:{widget_key:_emv.campaign,h:window.location.host,cache:Math.random(),tz_offset:f.getTz()},success:function(e){f.log("Campaign Loaded from Server",e),void 0===e.widget_key&&f.log("Invalid widget_key"),t=new Date((new Date).getTime()+18e4);var t,o=!(f.W={widget_key:e.widget_key,user_id:e.user_id,active:e.active,active_changed:e.active_changed||!1,night_mode:e.night_mode,catch_on_exit:e.catch_on_exit,catch_by_timer:e.catch_by_timer,catch_by_timer_time:e.catch_by_timer_time,allow_multiple_conversions:e.multiple_conversions,timeout:e.timeout,callback_time:e.callback_time,float_button:e.float_button,mobile_button:e.mobile_button,country:e.country||"ru",lang:e.lang||"ru",position:e.position,chat:e.chat||0,chat_uid:e.chat_uid||0,chat_id:e.chat_id||0,tooltip_scroll:e.tooltip_scroll,tooltip_hover:e.tooltip_hover,suitable_time:e.suitable_time,magic_forms:e.magic_forms,magic_forms_callback:e.magic_forms_callback,magic_forms_night_mode:e.magic_forms_night_mode,facebook_pixel_id:e.facebook_pixel_id||"",facebook_pixel_event:e.facebook_pixel_event||"",status:e.status,block_desc:e.block_desc,hide_call_timer:e.hide_call_timer,faq_settings:e.faq_settings,personal_agreement:e.personal_agreement,personal_agreement_markup:e.personal_agreement_markup,personal_agreement_checked:e.personal_agreement_checked});return f.W.widget_key!=_emv.campaign&&(f.log("is_geo_office = true"),f.storage=null,f.restartStorage(f.W.widget_key),o=!0),e.chat&&e.chat_uid&&e.chat_data&&(e.chat_data.operators&&f.storage.localStorage.set("chat_operators",e.chat_data.operators),e.chat_data.settings)&&(f.storage.localStorage.set("chat_settings",e.chat_data.settings),f.chat_settings=e.chat_data.settings,f.W.chat_init="hide"),e.form_settings&&(f.form_settings=e.form_settings,f.storage.localStorage.set("form_settings",e.form_settings)),void 0!==e.url_config&&void 0!==e.url_config.urls&&0<e.url_config.urls.length?f.storage.localStorage.set("url_config",e.url_config):f.storage.localStorage.remove("url_config"),void 0!==e.scheduler&&void 0!==e.scheduler.days&&void 0!==e.scheduler.times?f.storage.localStorage.set("scheduler",e.scheduler):f.storage.localStorage.remove("scheduler"),void 0!==e.departments&&1<e.departments.length?f.storage.localStorage.set("departments",e.departments):f.storage.localStorage.remove("departments"),f.setCookie(f.cc,f.W,{path:"/",expires:t}),o?f.initWidget():f.campaignLoaded(e)},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpCallback"})}if(f.restarted||(f.$(window).on("beforeunload",function(){f.unloadWidget()}),setInterval(function(){f.stat.t++,f.total_time++,f.stat.a=f.total_time},1e3)),void 0===f.getCookie(f.cg))return t=ldbck.generateUUID(),f.setCookie(f.cg,{guid:t,converted:!1,t:0},{path:"/",expires:99999}),ldbck.log("New GUID Cookie Created"),f.removeCookie(f.cc,{path:"/"},e());if(ldbck.log("Loaded GUID Cookie"),f.total_time=f.getCookie(f.cg).t,void 0!==f.getCookie(f.cg).l&&(f.last_visit_timeout=Math.round(((new Date).getTime()-f.getCookie(f.cg).l)/1e3)),f.log("self.last_visit_timeout="+f.last_visit_timeout),void 0===f.getCookie(f.cc))return e();ldbck.log("Campaign Loaded from Cookie");var t=f.getCookie(f.cc);if(t.chat&&t.chat_uid&&!0===f.storage.localStorage.isEmpty("chat_operators"))return f.log("force LOAD Campaign (empty storage)"),e();f.W=t;try{clearInterval(f.countDownInterval)}catch(e){}return f.campaignLoaded(t)},f.unloadWidget=function(){if(void 0!==f.getCookie(f.cg)&&(f.setCookie(f.cg,{guid:f.getCookie(f.cg).guid,converted:f.getCookie(f.cg).converted,t:f.total_time,l:(new Date).getTime()},{path:"/",expires:99999}),window._emv))try{delete window.ldbck_loaded}catch(e){}},f.campaignLoaded=function(e){if(f.log("compaignLoaded",f.W),"block"==f.W.widget_key)return f.W.block_desc&&console.log("Widget is blocked. Reason: "+f.W.block_desc),!1;if("0"==f.W.status)return f.log("Widget is turn off!");if(!f.W.active&&!f.W.night_mode&&!f.is_vk)return f.log("Not active!");if(!f.storage.localStorage.isEmpty("url_config")){var t=f.storage.localStorage.get("url_config"),o=document.location.href;try{o=decodeURIComponent(document.location.href)}catch(e){f.log(e)}for(var i,a="allow"!=t.rule,n=0,l=t.urls.length;n<l;n++){-1===(i=t.urls[n]).replace("http://","").replace("https://","").indexOf("/")&&(f.log("adding trailing slash to pattern: "+i+" => "+i+"/"),i+="/"),i=i.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&").replace(/([*])/g,".+"),0!==t.urls[n].indexOf("http:")&&0!==t.urls[n].indexOf("https:")||-1!==t.urls[n].indexOf("*")||(f.log("full url pattern: "+i),i="^"+i+"$");var r=new RegExp(i);if(f.log("CHECK pattern["+t.rule+"]:"+i),r.test(void 0)||r.test(o)){if("allow"==t.rule){f.log("ALLOWED: "+i),a=!0;break}if("deny"==t.rule){f.log("DENIED: "+i),a=!1;break}}}if(!1===a)return f.log("Not allowed by url config")}var s,c;f.W.callback_time&&(f.timer=1e3*f.W.callback_time),s=f.getCookie(f.cg).converted,c=f.W.allow_multiple_conversions,f.is_vk?f.insertWidget(f.W,!0):("1"==f.W.chat&&f.W.chat_id&&f.W.chat_uid&&"undefined"==typeof Cloudim&&(f.log("Chat IS ON",f.W.chat_id),f.loadScript(f.CHAT_CDN+"chat.js?v2.2",!0,function(){f.log("Chat IS loaded"),Cloudim.Options.Chat.silent=!0,f.DEBUG&&(Cloudim.Options.debug=!0);var e,t="rand";f.storage.localStorage.isEmpty("chat_settings")||void 0!==(e=f.storage.localStorage.get("chat_settings")).operators_queue&&(t=e.operators_queue),"all"!=t&&4543!=f.W.user_id||(f.ACCEPT_CHATS=!0,Cloudim.Options.accept_chats=!0),Cloudim.Api.bind("onInit",function(e){f.log("Chat EVENT onInit");var i=!1;"#demomode"==window.location.hash&&(f.log("Demo CHAT mode ON"),window.location.hash="#demomode-chat",Cloudim.Api.clearCache(),i=!0),f.Chat.widget_key||f.loadScript(f.JS_CDN+"leadback-chat-api.js?v="+f.version,!0,function(){f.log("LOADED leadback-chat-api.js",f.version);var o=setInterval(function(){var e,t;!0===f.dom_is_ready?(clearInterval(o),f.Chat=_LBCHATAPI.init(f,f.W),f.Events._callEvent("onChatReady",f.Chat.Api),i?(f.log("CHAT IS Clear"),f.Chat.removeAllChatState(),window.location.reload()):(e=[],f.storage.localStorage.isEmpty("user_info")||(t=f.storage.localStorage.get("user_info"),e.push({name:"fullName",value:t.name}),e.push({name:"Email",value:t.email}),e.push({name:"Phone",value:t.phone})),0<e.length&&Cloudim.Api.sendUserData(e))):f.log("wait_insert_widget...")},100)})}),Cloudim.Api.bind("onReady",function(){f.log("Chat EVENT onReady"),Cloudim.Api.bind("onOperatorChange",function(e){f.DEBUG&&alert("operatorChanged"),e.operator&&f.Chat.acceptChat(e.operator)}),Cloudim.Api.bind("onExternalEvent",function(e){f.log("Chat EVENT onExternalEvent"),"xmpp.operator.cobrowse.internal.page"==e.event&&f.coBrowseV2()}),f.$("#cloudim_chat").hide();var e=setInterval(function(){f.Chat.widget_key&&(clearInterval(e),f.$(window).bind("hashchange",function(){"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done",null!==f.Chat.is_online)&&(f.Chat.openChat(),f.Chat.scrollChatsToBottom(!0))}),Cloudim.Api.getCurrentOperator(function(e){if(f.log("check Offline mode",e),f.ACCEPT_CHATS&&1<e.length&&f.Chat.setAcceptChatMode(e),!1===e)if(f.log("Chat EVENT Offline"),f.Chat.getChatSettings("offline_invite"))if(!1===f.Chat.is_online)f.log("Chat now in offline -> exit");else{f.Chat.setOfflineMode();var t=f.storage.localStorage.get("chat_operators"),o=Math.round(Math.random()*(t.length-1)),e=(f.storage.localStorage.isEmpty("chat_operator")?f.storage.localStorage.set("chat_operator",o):0<=(i=f.storage.localStorage.get("chat_operator"))&&i<t.length&&(o=i),t[o]),i=(f.Chat.setOperator(e.operator_name,e.avatar_url),f.Chat.clearChatHistroy(),f.Chat.getChatInviteState()),t=f.Chat.getChatSettings("offline_invite_goal"),a=[],o=(a[0]=f.Chat.getChatSettings("offline_invite_greeting"),void 0===t||"bot"==t||"bot_contacts"==t?(a[1]=f.Chat.getChatSettings("offline_invite_offer"),a[2]=f.Chat.getChatSettings("offline_invite_action"),f.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").show()):(a[1]=f.Chat.getChatSettings("offline_invite_offer_2"),a[2]=f.Chat.getChatSettings("offline_invite_action_2"),f.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").hide()),[]);if(o[0]=f.Chat.getChatSettings("offline_invite_call_offer"),o[1]=f.Chat.getChatSettings("offline_invite_call_action"),f.log("invite_goal",t),f.log("invite state",i),i.called||i.converted)if(f.log("converted & called"),void 0===t||"bot"==t||"bot_contacts"==t){f.log("Invite goal "+t+" toggle button"),f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(a,!0,!0);var n=f.Chat.readLocalMessages();if(n&&n.length)for(var l=0,r=n.length;l<r;l++)f.Chat.addMessageInChat(n[l],"visitor",new Date,!0);f.Chat.inviteVisitorInCall(o,!0)}else"call"===t&&(f.log("Invite goal call toggle button"),f.Chat.toggleOperatorButton());else i.readed||i.invited?(f.log("invited & readed"),f.Chat.removeLocalMessages(),f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(a,!0,i.readed)):(f.log("NOT invited"),f.Chat.removeLocalMessages(),e=f.Chat.getChatSettings("offline_invite_delay"),f.log("getChatSettings -> offline_invite_delay",e),setTimeout(function(){f.log("RUN OFFLINE INVITE"),f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(a),f.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*e))}else f.log("Chat offline_invite IS OFF"),f.chat_is_suspended=!0;else f.Chat.showChatButton()}))},100)}),Cloudim.Api.bind("onShowTab",function(e){f.log("Chat EVENT onShowTab")}),Cloudim.Api.bind("onClose",function(){f.log("Chat EVENT onClose")}),Cloudim.Api.bind("onOpen",function(){f.log("Chat EVENT onOpen")}),Cloudim.Api.bind("onMessage",function(e){f.log("Chat EVENT onMessage"),clearTimeout(f.Chat.operator_answer_timeout),clearTimeout(f.Chat.operator_wait_timeout),f.Chat.stopAnswerSimulation(),f.Chat.addMessageInChat(e.message,"operator",null,null,e.silent),void 0!==e.data&&"string"==typeof e.data.cobrowsing&&f.Chat.startCoBrowsing(e.data.cobrowsing,"Оператор",e.message),f.Chat.clearFaqMessages(),f.Chat.saveIsLiveChat(),f.Chat.chatIsOpen()||(f.Chat.addOperatorMessageInBaloon(e.message,!f.Chat.isLayoutBalloonVisible()),f.Chat.isLayoutBalloonVisible()||f.Chat.showLayoutBalloon(!1),f.Chat.increaseBadge(),e=f.Chat.getChatState(),f.Chat.saveChatState(e.open,+e.unread+1))}),Cloudim.Api.bind("onClientMessage",function(e){f.log("Chat EVENT onClientMessage"),f.Chat.addMessageInChat(e.message,"visitor",null,null,!0)}),Cloudim.Api.bind("onTyping",function(e){f.log("Chat EVENT onTyping"),clearTimeout(f.Chat.operator_answer_timeout),clearTimeout(f.Chat.operator_wait_timeout),!0===e.typing?f.Chat.operatorWriting():!1===e.typing&&f.Chat.operatorNotWriting()}),Cloudim.Api.bind("onOnline",function(){f.log("Chat EVENT onOnline");var e=setInterval(function(){f.Chat.widget_key&&(clearInterval(e),null!==f.Chat.initial_status?f.log("IGNORE Chat EVENT onOnline"):f.chat_is_suspended?f.log("CHAT SUSPENDED SKIP"):(f.Chat.showChatButton(),Cloudim.Api.getVisitor(function(e){f.log("visitor",e),e.chatted&&f.Chat.toggleOperatorButton();var t=f.Chat.getChatState();if(0<t.unread)for(var o=0;o<t.unread;o++)f.Chat.increaseBadge();f.Chat.clearChatHistroy(),f.Chat.loadHistory(e.history),e.jid&&f.Chat.setVisitorJid(e.jid),(t.open&&!f.isMobile()||"#chatopen"==window.location.hash)&&(f.Chat.openChat(),f.Chat.scrollChatsToBottom(!0),"#chatopen"==window.location.hash)&&(window.location.hash="#chatopen-done")}),Cloudim.Api.getCurrentOperator(function(e){var t,o,i,a;f.log("getCurrentOperator",e),f.ACCEPT_CHATS&&1<e.length&&f.Chat.setAcceptChatMode(e),e?(f.Chat.setOnlineMode(),a=f.Chat.getChatInviteState(),f.log("invite_state",a),o=f.Chat.getChatSettings("chat_invite"),f.log("getChatSettings -> chat_invite",o),i=f.Chat.isChattedVisit(),f.log("isChattedVisit -> is_chatted_visit",i),f.Chat.initFaq(),o&&!i&&((t=[])[0]=f.Chat.getChatSettings("chat_invite_greeting"),t[1]=f.Chat.getChatSettings("chat_invite_offer"),t[2]=f.Chat.getChatSettings("chat_invite_action"),f.log("getChatSettings -> invite messages",t),a.invited?(a.invited,a.readed?a.invited&&a.readed&&!a.converted&&(f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(t,!0,!0)):(f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(t,!0))):(o=f.Chat.getChatSettings("invite_delay"),f.log("getChatSettings -> invite_delay",o),clearTimeout(f.Chat.invite_timeout),f.Chat.invite_timeout=setTimeout(function(){f.log("RUN INVITE"),f.Chat.toggleOperatorButton(),f.Chat.inviteVisitorInChat(t),f.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*o))),i=f.storage.localStorage.get("chat_operators"),(a=f.Chat.getCurrentOperator(e,i))?f.Chat.setOperator(a.operator_name,a.avatar_url):0<i.length&&0<e.length&&(i=f.Chat.getOnlineWidgetOperators(i,e)).length?f.Chat.setOperator(i[0].operator_name,i[0].avatar_url):f.Chat.setOperator("Оператор","/images/portraits/2.jpg")):f.log("Chat EVENT Offline 2")}),f.Chat.Events._callEvent("onOnline")))},100)}),f.DEBUG?(f.log("Chat DEBUG is ON"),Cloudim.Chat.init({uid:20621})):Cloudim.Chat.init({uid:f.W.chat_uid,group:f.W.chat_id})})),f.loadScript(f.JS_CDN+"_assets.min.js?v="+f.version,!0,function(){if(f.W.float_button&&f.log("float_button IS ON"),f.isMobile())f.W.mobile_button?f.insertWidget(f.W):f.log("mobile_button IS OFF");else if(f.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(f.insertWidget(f.W,!0),window.location.hash="#callback-showed")}),"#leadback"==window.location.hash)setTimeout(function(){f.insertWidget(f.W,!0)},3e3);else{if(!s||c||f.W.float_button)return f.insertWidget(e);f.log("Already Converted!")}})),f.sendEvent("pageview")},f.insertWidget=function(e,_){var t;!0===f.dom_is_ready?(f.log("Widget has be inserted"),_&&f.showWidget(f.$("#lb_widget-root"))):(f.log("insertWidget"),t=window.location.host,t=encodeURI(f.PUBLIC_SERVER+"backend/widget_widget.php?h="+t+"&widget_key="+f.W.widget_key+"&v="+f.version),f.is_vk?f.DEBUG||(t+="&vk_api="+encodeURIComponent(document.location.href)):(f.isMobile()?t=t+"&mobile&chat="+f.W.chat:(t+="&chat="+f.W.chat,f.log("self.W.chat_init",f.W.chat_init)),"1"==f.W.chat&&f.W.chat_init&&(t+="&chat_init="+f.W.chat_init)),f.log("url",t),f.$.ajax({type:"GET",async:!0,cache:!0,url:t,error:function(e,t,o){return f.log(o),f.log("Main HTML Failed to Load")},success:function(e){var t="",a=(t=""==f.W.position?"bottom: 50px; right: 50px":f.W.position,f.$("<div id='lb_widget-root'><div id='lb_widget-wrapper' style='display:none;'></div><div id='lb_eula_widget-wrapper' style='display:none;'></div><div id='lb_button-wrapper' style='position: fixed; "+t+" ; z-index: 10000000000;'></div></div>"));if(a.find("#lb_widget-wrapper").html(e.html).hide(),a.find("#lb_eula_widget-wrapper").html(e.eula).hide(),a.find("#lb_widget-wrapper .lb_callback_time").text(f.W.callback_time||27),!f.storage.localStorage.isEmpty("scheduler")&&(!f.W.active&&f.W.night_mode&&(void 0===f.W.suitable_time||"nigth"==f.W.suitable_time)||void 0!==f.W.suitable_time&&"always"==f.W.suitable_time)){var n=f.storage.localStorage.get("scheduler");if("object"==typeof n&&0<n.days.length){a.on("click","#lb_widget-scheduler--link",function(e){e.preventDefault(),a.find("#lb_widget-scheduler").show(),a.find("#lb_widget-invite").hide(),a.find("#lb_timer").hide(),a.find("#lb_widget-scheduler--controls").hide(),a.find("#lb_widget-scheduler").data("opened",!0)}),a.on("change","#lb_widget-scheduler--days",function(e){var t=f.$("option:selected",this).data();if(null!==t){a.find("#lb_widget-scheduler--times").empty();for(var o=0,i=n.times[t.index].length;o<i;o++)a.find("#lb_widget-scheduler--times").append('<option value="'+f.escapeHtml(n.times[t.index][o].value)+'">'+f.escapeHtml(n.times[t.index][o].label)+"</option>")}});for(var o=0,i=n.days.length;o<i;o++)a.find("#lb_widget-scheduler--days").append('<option value="'+f.escapeHtml(n.days[o].value)+'" data-index="'+o+'">'+f.escapeHtml(n.days[o].label)+"</option>");a.find("#lb_widget-scheduler--days").trigger("change"),a.find("#lb_widget-scheduler--controls").show(),f.W.active||"use_holidays"!==f.W.active_changed||a.find("#lb_widget-scheduler--link").click()}}if(!f.storage.localStorage.isEmpty("departments"))for(var l=f.storage.localStorage.get("departments"),o=0,i=l.length;o<i;o++)a.find("#lb_widget-department--items").append('<label class="lb_widget-radio"><input type="radio" name="lb_widget-department--value" data-index="'+o+'" value="'+f.escapeHtml(l[o])+'" '+(0==o?'checked="checked"':"")+"/>&nbsp;"+f.escapeHtml(l[o])+"</label>");if(f.parseWidgetText(a),f.isMobile()){f.storage.localStorage.remove("history_states"),window.addEventListener("popstate",function(e){f.log("Event state",event);var t=f.storage.localStorage.get("history_states");if(t&&t.length)return t=t[t.length-1]+"",f.log("Last state is ",t),"widget"==t?(f.log("Poping state widget"),f.hideWidget(a),e.preventDefault(),!1):"dialog"==t?(f.log("Poping state dialog"),f.$multibutton.toggleClass("lb-widget--open-dialog"),f.deleteHistoryState("dialog"),e.preventDefault(),!1):"chat"==t&&Object.keys(f.Chat).length?(f.log("Poping state chat"),f.Chat.closeChat(),e.preventDefault(),!1):void 0},!1),f.$multibutton=a.find("ldiv.lb-widget"),f.is_multibutton=!!f.$multibutton.length,a.find("#lb_exit").on("click",function(){f.hideWidget(a)});var r,s=a.find("#lb_mobile-call"),c=a.find(".lb_mobile-wrapper");if(f.$("body").on("click",'a[href="#callback"]',function(e){f.showWidget(a),e.preventDefault()}),f.$("body").on("click","#lb_widget-root a.js-trigger-callback",function(e){f.showWidget(a),e.preventDefault()}),f.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(f.showWidget(a),window.location.hash="#callback-showed")}),"1"==f.W.chat){try{f.$(window).on("ready",function(){var e=f.screen_width/window.innerWidth;a.find(".lb-widget-button").css("zoom",1/e),a.find(".lb-widget-welcome-panel").css("zoom",1/e)})}catch(e){}s.on("click",function(){f.showWidget(a)})}else f.$(window).on("orientationchange load",function(){90==window.orientation||-90==window.orientation?(f.screen_width=Math.max(window.screen.availWidth,window.screen.availHeight),f.screen_height=Math.min(window.screen.availWidth,window.screen.availHeight)):(f.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),f.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)),f.mobileButton(s,c)}),f.$(window).on("touchmove",function(){f.mobileButton(s,c)}),f.$(window).on("touchstart",function(){s.css("opacity",0)}),f.$(window).on("touchend",function(){s.css("opacity",1),f.mobileButton(s,c)}),f.$(window).on("scroll",function(){s.css("opacity",0),clearTimeout(r),r=setTimeout(function(){s.css("opacity",1),f.mobileButton(s,c)},300)}),f.mobileButton(s,c),f.is_multibutton?(a.on("click","#lb_widget-wrapper .lb-widget-button",function(e){f.$multibutton.toggleClass("lb-widget--open-dialog"),f.writeHistoryState("dialog")}),a.on("click","#lb_widget-wrapper .lb-action-link--discard",function(e){e.preventDefault(),f.$multibutton.toggleClass("lb-widget--open-dialog"),f.deleteHistoryState("dialog")}),a.on("click","#lb_widget-wrapper .lb-widget > .lb-overlay",function(e){e.preventDefault(),f.$multibutton.hasClass("lb-widget--open-dialog")&&f.deleteHistoryState("dialog"),f.$multibutton.toggleClass("lb-widget--open-dialog")}),f.startMultiButtonSlides()):s.find(".lb-click_area").on("click",function(){f.showWidget(a)});c.find("input.lb_input").on("focus",function(){c.find(".lb_title-desc").hide(),c.find(".lb_form-label").show()}),f.is_multibutton&&(t=a.find("#lb-multibutton-style-os")).length&&(f.isIOS()?t.attr("href",f.PUBLIC_SERVER+"/css/multibutton/style-ios.min.css?"+f.version):t.attr("href",f.PUBLIC_SERVER+"/css/multibutton/style-android.min.css?"+f.version),t.on("load",function(){setTimeout(function(){f.$multibutton.show(),f.$multibutton.find(".lb-overlay").attr("style",""),f.$multibutton.find(".lb-dialog").attr("style","")},50)}))}else{if(f.$('a[href="#callback"]').on("click",function(e){f.showWidget(a),e.preventDefault()}),f.W.float_button&&e.button){a.find("#lb_button-wrapper").html(e.button),"1"==f.W.chat&&a.find(".phone-call_wave").removeClass("phone-call_wave__stroke");t=a.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(),t=f.parseMacros(t);if(t=f.parseInlineTemplates(t),t=f.parseCountDownMacros(t),a.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(t),a.find("#lb_button-call").hasClass("lb_fixed-button"))a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){f.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),f.storage.localStorage.set("tooltip_closed",!0))});else if("0"!=f.W.chat||f.isTouch())a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){f.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),f.storage.localStorage.set("tooltip_closed",!0))});else{a.find("#lb_button-wrapper").attr("title","Нажмите, чтобы заказать обратный звонок или перетащите, если кнопка мешает навигации.");try{f.$(a.find("#lb_button-call")[0]).draggableTouch().on("dragstart",function(e,t){this.ignoreClick=!1,t&&(this.startPosition=t)}).on("dragend",function(e,t){t&&this.startPosition.top-t.top!=0&&this.startPosition.left-t.left!=0&&(this.ignoreClick=!0)}),a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){a.find("#lb_button-call")[0].ignoreClick||(f.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),f.storage.localStorage.set("tooltip_closed",!0)))})}catch(e){a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){f.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),f.storage.localStorage.set("tooltip_closed",!0))})}}var d,g=null,e=(f.$(document).innerHeight()-f.$(window).height())/f.$(window).height();"0"==f.W.chat&&.5<e?(a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),f.$(document).on("scroll",function(){if(f.widgetIsShow(a))return!0;var e=f.$(document).scrollTop()/(f.$(document).innerHeight()-f.$(window).height());a.find("#lb_button-wrapper .lb_call-btn").css("opacity",1),clearInterval(g),g=setInterval(function(){e<=.3&&a.find("#lb_button-wrapper .lb_call-btn").css("opacity",.7),clearInterval(g)},500),(150<f.$(document).scrollTop()||.3<e)&&(clearInterval(null),a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),300<f.$(document).scrollTop())&&.4<e&&a.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse")})):(a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),"0"==f.W.chat?a.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"):a.find("#lb_button-wrapper .lb_call-btn").css("opacity",1)),f.W.tooltip_scroll&&(d=null,f.$(document).on("scroll",function(){clearInterval(d),.5<=f.$(document).scrollTop()/(f.$(document).innerHeight()-f.$(window).height())&&(d=setTimeout(function(){f.storage.localStorage.isEmpty("tooltip_closed")||!1===f.storage.localStorage.get("tooltip_closed")?void 0===a.find("#lb_button-call:hover")[0]&&a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--hide")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--hide").addClass("lb_button_tooltip--show"),setTimeout(function(){a.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--alert")},3e3)):f.log("tooltip_closed"),clearTimeout(d)},500))})),f.W.tooltip_hover&&a.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--hover"),a.find("#lb_button-wrapper .lb_button_tooltip .lb_button_tooltip--close").on("click",function(e){a.find("#lb_button-wrapper .lb_button_tooltip--container").remove(),f.storage.localStorage.set("tooltip_closed",!0)})}a.find("#lb_exit").on("click",function(){f.hideWidget(a)}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(f.log("Escape key detected"),f.hideWidget(a))})}a.on("click",".lb_eula--link",function(e){e.preventDefault(),e.stopPropagation(),f.showEula(f.$(this).attr("href"))}),a.on("click","#lb_eula_widget-wrapper",function(){f.hideEula()});var u,h=f.getPhonePrefix(),t=(a.on("focus","#lb_phone",function(){var e=f.$(this);""==e.val()&&e.val(h),e.val()==h&&setTimeout(function(){e.get(0).selectionStart=e.get(0).selectionEnd=100},10)}).on("change","#lb_phone",function(){var e=f.$(this).val().replace(/[^\d\+]+/g,"");f.$(this).val(e),!1!==(e=f.checkPhone(e))&&f.$(this).val(e)}).on("keypress","#lb_phone",function(e){var t=f.$(this).val().replace(/[^\d\+]+/g,"");"+789"===t.substr(0,4)&&f.$(this).val("+7"+t.substr(3)),13==e.which&&(a.find("#lb_send").trigger("click"),e.preventDefault())}).on("paste","#lb_phone",function(e){return e.preventDefault(),!1}).on("drop","#lb_phone",function(e){return e.preventDefault(),!1}).attr("placeholder",h),a.on("click","#lb_send",function(){var e;!f.storage.localStorage.isEmpty("departments")?(e=a.find("#lb_phone").val(),!1===(e=f.checkPhone(e))?a.find("#lb_phone").addClass("lb_error"):(a.find("#lb_phone").removeClass("lb_error"),a.find("#lb_widget-invite").hide(),a.find("#lb_widget-scheduler").hide(),a.find("#lb_widget-form").hide(),a.find("#lb_widget-scheduler--controls").hide(),a.find("#lb_widget-department").show(),a.find("#lb_send--department").on("click",function(){f.callTo(a)}))):f.callTo(a)}),!f.W.active&&f.W.night_mode&&(a.find("#lb_timer").hide(),a.find(".lb_h6").css("visibility","hidden")),f.$("body").append(a),f.isMobile()&&a.find("#lb_widget-wrapper").show(),f.dom_is_ready=!0,f.getCookie("__leadback_need_call"));t?(f.log("Run magic_form"),f.removeCookie("__leadback_need_call",{path:"/"}),f.$("#lb_phone").val(t.phone),t.form_type&&-1!==["magic_form","manual_form"].indexOf(t.form_type)||(t.form_type="magic_form"),e={},"magic_form"===t.form_type?e.initiator="magic_forms":"manual_form"===t.form_type&&(e.initiator="manual_forms"),void 0!==f.W.magic_forms_callback&&"show"===f.W.magic_forms_callback&&f.showWidget(a),void 0!==t.label&&(e.label=t.label),f.callTo(a,e)):(_?f.showWidget(a):void 0!==f.W.catch_on_exit&&!f.W.catch_on_exit||f.startCursometer(a),void 0!==f.W.catch_by_timer&&f.W.catch_by_timer&&(u=1e3*f.W.catch_by_timer_time,void 0===f.getCookie(f.ct)?setTimeout(function(){f.log("Time show after: "+u),f.showWidget(a),f.setCookie(f.ct,{campaign:f.W.widget_key,user_id:f.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*f.W.timeout)})},u):f.log("Time show timeout"))),"function"==typeof window.muse_init&&f.$("body").addClass("initialized"),f.W.personal_agreement_markup&&f.W.personal_agreement_checked&&a.find("div.lb_eula-container").find('input[type="checkbox"]').length&&a.find("div.lb_eula-container").find('input[type="checkbox"]').attr("checked","checked")},dataType:"jsonp",jsonpCallback:"jsonpWidgetCallback"}),void 0!==f.W.magic_forms&&(t=!1,!f.W.active&&f.W.night_mode&&"off"===f.W.magic_forms_night_mode&&(t=!0),"none"!==f.W.magic_forms)&&!1===t&&(f.setupForms(),"undefined"!=typeof MutationObserver)&&(f.leadbackObserver=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){var t;e.tagName&&"FORM"===e.tagName?(f.log("Mutation observer added form",e),f.setupForms()):e.tagName&&e.children&&(t=e.querySelectorAll("form"),f.log("Searching forms in added node",e,"inner forms length",t?t.length:0),t)&&t.length&&f.setupForms()})})}),f.leadbackObserver.observe(document.documentElement||document.body,{subtree:!0,childList:!0})))},f.setupForms=function(){if("manual"===f.W.magic_forms){if(f.form_settings=f.storage.localStorage.get("form_settings"),!1!==f.form_settings&&f.form_settings.forms&&f.form_settings.forms.length){f.log("###########"),f.log("FORM SETTINGS RECEIVED AND ACTIVE",f.form_settings);for(var e=[],t=f.form_settings.use_custom_selector&&Number(f.form_settings.use_custom_selector),o=0;o<f.form_settings.forms.length;o++)e.push({selector:f.form_settings.forms[o].selector,data:f.form_settings.forms[o]});for(t&&e.push({selector:"form.lb-magic-form",data:null}),f.log(">>> Form selectors getted",e),f.log(">>> Magic forms are: "+t),f.log("###########"),o=0;o<e.length;o++){var i=f.$(e[o].selector+":not([data-ldbck-form-init])");if(i&&i.length)for(var a=0;a<i.length;a++){var n,l=f.$(i[a]);f.log(">>> Form with selector",e[o].selector,"FOUND. Full class list: ",l.attr("class")),l.attr("data-ldbck-form-init",1),l.data("form-data",e[o].data),"#debug"===document.location.hash&&l.attr("style","border: 1px solid red !important"),e[o].data?(f.log(">>> Form with selector",e[o].selector,"has selector custom data",e[o].data),"onSubmit"===l.data("form-data").event?(f.log(">>> Binding form onSubmit"),l.on("submit",function(){f.log(">>> Manual form onSubmit");var e=f.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(f.log(">>> Manual form has redirect, setting cookie"),f.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(f.log(">>> Manual form has no redirect, calling from widget"),f.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==f.W.magic_forms_callback&&"show"===f.W.magic_forms_callback&&f.showWidget(f.$("#lb_widget-root")),e.label=this.data("form-data").name,f.callTo(f.$("#lb_widget-root"),e)))}.bind(l))):(f.log(">>> Binding form manual onClick"),l.data("form-data").button_selector&&(f.log(">>> manual form onClick selector: ",l.data("form-data").button_selector),(n=f.getFormChildBySelector(l,l.data("form-data").button_selector))&&n.length?(f.log(">>> Manual form onClick has button",n),n.on("click",function(){var e=f.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(f.log(">>> Manual form onClick has redirect setting cookie"),f.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(f.log(">>> Manual form has no redirect, calling from widget"),f.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==f.W.magic_forms_callback&&"show"===f.W.magic_forms_callback&&f.showWidget(f.$("#lb_widget-root")),e.label=this.data("form-data").name,f.callTo(f.$("#lb_widget-root"),e)))}.bind(l))):f.log(">>> Button by selector "+l.data("form-data").button_selector+" NOT FOUND !!!")))):(f.log(">>> MAGIC FORM DETECTED!!! Making submit event"),l.attr("data-ldbck-form-init",1),l.on("submit",function(){var e=f.getPhoneByInputSelector("input",this);e&&f.setNeedCallCookie(e,f.$(this).data("magic-form-label"),"magic_form")})),f.log("###########")}}}}else for(var t="",r=("custom"===f.W.magic_forms&&(t=".lb-magic-form"),f.log(">>> Automatic magic forms section: "+t),f.$("form"+t+":not([data-ldbck-form-init])")),s=0;s<r.length;s++){var c=f.$(r[s]);c.attr("data-ldbck-form-init",1),c.on("submit",function(){var e=f.getPhoneByInputSelector("input",this);e&&f.setNeedCallCookie(e,f.$(this).data("magic-form-label"),"magic_form")})}},f.getFormChildBySelector=function(e,t){var o=e.find(t);if(f.log(">>> Searching child inside form",t),o&&o.length)return f.log(">>> Found child inside form",t),o;if(f.log(">>> Form child with selector (",t,") not found, searching global"),(o=f.$.find(t))&&o.length){f.log(">>> Children ("+o.length+") with selector (",t,") found global! Trying to search in child form...",o);for(var i=0;i<o.length;i++){var a=e.find(o[i]);if(a&&a.length)return f.log(">>> Child with selector (",t,") found in form!"),a}}return f.log(">>> Child with selector (",t,") not found in form!"),null},f.getManualFormPhone=function(e){var t,o,i=null;return e.data("form-data").fields&&e.data("form-data").fields.length&&(t=e.data("form-data").fields.filter(function(e){return"phone"===e.type&&""!==e.selector.trim()}))&&t.length&&(t=t[0],o=f.getFormChildBySelector(e,t.selector))&&o.length&&(i=f.checkPhone(o.val()),f.log(">>> Result phone FOUND by settings field selector",t.selector,"with value",i)),i||(i=f.getPhoneByInputSelector("input",e),f.log(">>> Getting result phone by all inputs",i)),i},f.setNeedCallCookie=function(e,t,o){f.setCookie("__leadback_need_call",{phone:e,label:t,form_type:o},{path:"/",expires:new Date((new Date).getTime()+6e4)})},f.getPhoneByInputSelector=function(e,t){var a=[],o=(f.$(e,t).each(function(e,t){var o=0;if(void 0!==f.$(t).attr("type")){if(i=f.$(t).attr("type"),-1===["tel","text"].indexOf(i))return;"tel"===i&&(o+=50)}void 0!==f.$(t).attr("name")&&(i=f.$(t).attr("name"),-1!==["phone","number","callback","tel","telephone"].indexOf(i))&&(o+=50);var i=f.checkPhone(t.value);!1!==i&&(a[a.length]={value:i,priority:o})}),null);if(0<a.length)for(var i=0,n=a.length;i<n;i++)(null===o||a[i].priority>o.priority)&&(o=a[i]);return o?o.value:null},f.checkPhone=function(e){return!("7"==(e="789"==(e="8"==(e="495"!=(e="9"==(e=e.replace(/[^\d]+/g,"")).substr(0,1)&&10==e.length?"7"+e:e).substr(0,3)&&"499"!=e.substr(0,3)&&"812"!=e.substr(0,3)&&"4832"!=e.substr(0,4)||10!=e.length?e:"7"+e).substr(0,1)&&11==e.length?"7"+e.substr(1):e).substr(0,3)&&12==e.length?"7"+e.substr(2):e).substr(0,1)&&11!=e.length||11!=e.length&&12!=e.length)&&"+"+e},f.startCursometer=function(t){f.restarted||f.isMobile()?f.log("IGNORE startCursometer"):(f.log("startCursometer"),f.$(window).cursometer({onUpdateSpeed:function(e,t){if(null!==e)return f.LAST_SPEED=t},updateSpeedRate:15}),f.$("html").mouseout(function(e){e=e||window.event,f.LAST_X_POSITION=e.clientX,f.LAST_Y_POSITION=e.clientY,0<f.LAST_Y_POSITION||f.LAST_X_POSITION<200||(f.total_time>=f.activity?(e=void 0===f.getCookie(f.cg)||!f.getCookie(f.cg).converted||f.W.allow_multiple_conversions,.225<f.LAST_SPEED&&e&&void 0===f.getCookie(f.ct)&&f.last_visit_timeout<300?(f.stat.x=f.LAST_X_POSITION,f.stat.y=f.LAST_Y_POSITION,f.stat.s=f.LAST_SPEED,f.showWidget(t),f.setCookie(f.ct,{campaign:f.W.widget_key,user_id:f.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*f.W.timeout)}),f.log("Set timeout "+f.W.timeout)):f.log("Impression timeout",f.last_visit_timeout,void 0===f.getCookie(f.ct))):f.log("activity",f.activity,f.total_time,f.last_visit_timeout))}))},f.writeHistoryState=function(e){if(void 0!==window.history)try{var t=f.storage.localStorage.get("history_states"),o=(t?t.push(e):t=[e],f.storage.localStorage.set("history_states",t),{});o["ldbck_"+e+"_showed"]=1,f.log("Writing history state",e),window.history.pushState(o,"")}catch(e){console.warn("exc",e)}},f.deleteHistoryState=function(e){f.log("Deleting history state",e);var t=f.storage.localStorage.get("history_states");t&&-1<t.indexOf(e)&&(t.splice(t.indexOf(e,1)),f.log("updating history",t),f.storage.localStorage.set("history_states",t))},f.showWidget=function(e){f.log("showWidget"),f.widgetIsShow(e)?f.log("IS now shoed"):("function"==typeof f.beforeOpenWidget&&f.beforeOpenWidget(),f.runCountDownTimers(),f.sendEvent("impression"),f.sendGoal("LEADBACK_OPEN"),e.show(),f.isMobile()?(f.writeHistoryState("widget"),e.find(".lb_mobile-wrapper").show(),f.mobileAdoptation()):(e.find("#lb_widget-wrapper").show(),e.find("#lb_phone").focus()),f.W.float_button&&e.find("#lb_button-wrapper").hide()),void 0!==f.W.hide_call_timer&&f.W.hide_call_timer&&e.find("#lb_timer").hide(),f.log("Markup",f.W.personal_agreement_markup)},f.hideWidget=function(e){e.find("#lb_widget-scheduler").is(":visible")&&(e.find("#lb_widget-scheduler").hide(),e.find("#lb_widget-scheduler").data("opened",!1),e.find("#lb_widget-invite").show(),f.W.active&&e.find("#lb_timer").show(),e.find("#lb_widget-scheduler--controls").show()),f.isMobile()?(f.deleteHistoryState("widget"),f.sendGoal("LEADBACK_CLOSE"),e.find(".lb_mobile-wrapper").hide(),f.mobileAdoptation()):(f.sendGoal("LEADBACK_CLOSE"),e.find("#lb_widget-wrapper").hide(),f.W.float_button&&e.find("#lb_button-wrapper").show())},f.startMultiButtonSlides=function(){return!!f.is_multibutton&&setInterval(function(){var o,i,e;f.dom_is_ready&&(o=null,f.$("#lb_widget-root .lb-button__slides .lb-button-slides__item").not(".lb-widget-panel__item--hide").each(function(e,t){f.$(t).hasClass("lb-button-slides__item--active")?(o=e,f.$(t).removeClass("lb-button-slides__item--active"),(i=f.$(t).data("slide-action"))&&f.$(t).closest(".lb-button-flipper__front").removeClass("lb-button-flipper__front--"+i)):null!==o&&(f.$(t).addClass("lb-button-slides__item--active"),o=null,i=f.$(t).data("slide-action"))&&f.$(t).closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i)}),null!==o)&&((e=f.$("#lb_widget-root .lb-button__slides .lb-button-slides__item:first-child").not(".lb-widget-panel__item--hide")).addClass("lb-button-slides__item--active"),i=e.data("slide-action"))&&e.closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i)},1e4)},f.getUrlParameter=function(e){var t=location.search;e=e.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t),t="";return e&&0<e.length&&(t=e[1].replace(/\+/g," "),t=decodeURIComponent(t),t=(t=f.escapeHtml(t)).replace(/\_/g," ")),null===e?"":t},f.checkCanReplaceMacro=function(e){if("string"!=typeof e)return!1;for(var t=["/images/uploads/chat","https://leadback.ru/ya-money?payment=","https://leadback.ru/chat-payments?payment=","s3upload://","https://leadback.s3.eu-central-1.amazonaws.com/chat_uploads/","https://leadback.s3.eu-central-1.amazonaws.com/uploads/","https://leadback.s3.yandexcloud.net/chat_uploads/"],o=0;o<t.length;o++)if(0===e.indexOf(t[o]))return!1;return!0},f.parseQueryMacros=function(e){if(f.checkCanReplaceMacro(e)){var t,o=e.match(/\[get\:([^\]\|]+)\|?([^\]\|]+)?\]/gm);if(null!==o&&o.length)for(var i=0,a=o.length;i<a;i++){var n,l=o[i].replace(/^\[/,"").replace(/\]$/,"");e=-1<(n=(l=l.substr(l.indexOf(":")+1)).lastIndexOf("|"))?""!==(t=f.getUrlParameter(l.substr(0,n)))?e.replace(o[i],t):e.replace(o[i],l.substr(n+1)):(t=f.getUrlParameter(l),e.replace(o[i],t))}}return e},f.parseTimeMacros=function(e){if(f.checkCanReplaceMacro(e))for(var t,o=[],i=e.match(/\[(time)(\+|\-)?(\d+)?\]/gim),a=0,n=(o=null!==i?i:o).length;a<n;a++){var l=new Date,r=o[a].replace(/[\[\]]/g,"");e=(-1<r.indexOf("-")?(t=Number(r.split("-")[1]),l.setMinutes(l.getMinutes()-t)):-1<r.indexOf("+")&&(t=Number(r.split("+")[1]),l.setMinutes(l.getMinutes()+t)),e.replace(o[a],l.toLocaleTimeString().substr(0,l.toLocaleTimeString().lastIndexOf(":"))))}return e},f.parseMacros=function(e){return f.checkCanReplaceMacro(e)&&(e=f.parseNextDayMacro(e),e=f.parseTimeMacros(e),e=f.parseQueryMacros(e)),e},f.parseNextDayMacro=function(e){var t;return e=-1<e.indexOf("%nextDay%")||-1<e.indexOf("%nextDay2%")?"object"==typeof(t=f.storage.localStorage.get("scheduler"))&&0<t.days.length&&(t=Date.parse(t.days[0].value))?(t=new Date(t).getDay(),(e=e.replace(/%nextDay%/gi,f.getNextMacroDay(t,!1))).replace(/%nextDay2%/gi,f.getNextMacroDay(t,!0))):(e=e.replace(/%nextDay%/gi,"")).replace(/%nextDay2%/gi,""):e},f.getNextMacroDay=function(e,t){return(t?["в воскресенье","в понедельник","во вторник","в среду","в четверг","в пятница","в субботу"]:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"])[e]},f.getCountDownType=function(e){return!e||e.match(/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])\s?(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/)?"date":e.match(/time\+(\d+d;?)?(\d+h;?)?(\d+m;?)?/)?"time":e.match(/(\d+h;?)?(\d+m;?)?(\d+s;?)?/)?"none":"date"},f.addDays=function(e,t){return e.setTime(e.getTime()+24*t*60*60*1e3),e},f.addHours=function(e,t){return e.setTime(e.getTime()+60*t*60*1e3),e},f.addMinutes=function(e,t){return e.setTime(e.getTime()+60*t*1e3),e},f.addSeconds=function(e,t){return e.setTime(e.getTime()+1e3*t),e},f.parseCountDownMacros=function(e){if(f.checkCanReplaceMacro(e))for(var t,o=/\[countdown\|([^\]\|]+)\|?([^\]\|]+)?\|?([^\]\|]+)?\|?([^\]\|]+)?]/gi;null!==(t=o.exec(e));){var i,a,n,l,r,s,c="",d="";switch(f.getCountDownType(t[1])){case"date":c=t[1];break;case"time":for(r=t[1].replace("time+","").split(";"),s=0;s<r.length;s++)-1<r[s].indexOf("d")&&(i=r[s].replace("d","")),-1<r[s].indexOf("h")&&(a=r[s].replace("h","")),-1<r[s].indexOf("m")&&(n=r[s].replace("m",""));p=f.visit_date,i&&""!==i&&(p=f.addDays(p,i)),a&&""!==a&&(p=f.addHours(p,a)),n&&""!==n&&(p=f.addMinutes(p,n)),l&&""!==l&&(p=f.addSeconds(p,l));var g=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(p),u=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(p),h=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(p),_=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(p)),m=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(p)),p=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(p)),c=g+"-"+u+"-"+h+" "+(_=_<10?"0"+_.toString():_)+":"+(m=m<10?"0"+m.toString():m)+":"+(p=p<10?"0"+p.toString():p);break;case"none":for(r=t[1].replace("time+","").split(";"),c="",s=d=0;s<r.length;s++)-1<r[s].indexOf("h")&&(a=r[s].replace("h",""),d+=3600*Number(a)),-1<r[s].indexOf("m")&&(n=r[s].replace("m",""),d+=60*Number(n)),-1<r[s].indexOf("s")&&(l=r[s].replace("s",""),d+=Number(l))}e=e.replace(t[0],'<span class="lbwidget-countdown" data-ttl="'+d+'" data-date="'+c+'" data-tpl="'+(t[2]||"")+'" data-expire="'+(t[3]||"")+'" data-format="'+(t[4]||"")+'"></span>')}return e},f.runCountDownTimers=function(){try{clearInterval(f.countDownInterval)}catch(e){}f.replaceTTLDate(),f.setCountDownText(),f.countDownInterval=setInterval(function(){f.setCountDownText()},1e3)},f.replaceTTLDate=function(){for(var e=f.$("span.lbwidget-countdown"),t=0;t<e.length;t++){var o,i,a,n,l,r,s=f.$(e[t]);s.data("ttl")&&""!==s.data("ttl")&&((r=new Date).setTime(r.getTime()+1e3*Number(s.data("ttl"))+1e3),o=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(r),i=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(r),a=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(r),n=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(r)),l=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(r)),r=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(r)),n<10&&(n="0"+n.toString()),l<10&&(l="0"+l.toString()),r<10&&(r="0"+r.toString()),s.data("date",o+"-"+i+"-"+a+" "+n+":"+l+":"+r),s.attr("data-date",o+"-"+i+"-"+a+" "+n+":"+l+":"+r),s.data("ttl",""),s.removeAttr("ttl"))}},f.countdownTimeDeclensions={hour:["час","часа","часов"],minute:["минута","минуты","минут"],second:["секунда","секунды","секунд"]},f.declension=function(e,t,o,i,a){t=null==t?"":t,o=null==o?"я":o,i=null==i?"и":i,a=null==a?"й":a;var n=(e=null==e?0:e)%100,l="";if(10<=e&&e<=20||10<=n&&n<=20)l=a;else switch(e%10){case 1:l=o;break;case 2:case 3:case 4:l=i;break;default:l=a}return t+l},f.prepareCountDownText=function(e,t,o,i){if(e.data("date")&&""!==e.data("date")&&(c=Date.parse(e.data("date"))),isNaN(c)||!c)return"";4!==(i=(i=i||"дн. ,:,:,").split(",")).length&&(i="дн. ,:,:,".split(","));var a,n,l,r,s,e=c-(new Date).getTime(),c="";return 0<=e?(a=Math.floor(e/864e5),s=Math.floor(e%864e5/36e5),r=Math.floor(e%36e5/6e4),e=Math.floor(e%6e4/1e3),a=0<a?a+i[0]:"",n=(l=i[1]).replace(/[^а-яё]/gi,""),n=f.$.trim(n.toLowerCase()),-1<(n=f.countdownTimeDeclensions.hour.indexOf(n))&&(l=l.replace(f.countdownTimeDeclensions.hour[n],f.declension(s,"час","","а","ов"))),n=s<10?"0"+s.toString()+l:s.toString()+l,l=(s=i[2]).replace(/[^а-яё]/gi,""),l=f.$.trim(l.toLowerCase()),-1<(l=f.countdownTimeDeclensions.minute.indexOf(l))&&(s=s.replace(f.countdownTimeDeclensions.minute[l],f.declension(r,"минут","а","ы",""))),l=r<10?"0"+r.toString()+s:r.toString()+s,s=(r=i[3]).replace(/[^а-яё]/gi,""),s=f.$.trim(s.toLowerCase()),-1<(i=f.countdownTimeDeclensions.second.indexOf(s))&&(r=r.replace(f.countdownTimeDeclensions.second[i],f.declension(e,"секунд","а","ы",""))),c=a+n+l+(e<10?"0"+e.toString()+r:e.toString()+r),t&&(-1===t.indexOf("%s")&&(t+=" %s"),c=t.replace("%s",c))):o&&(c=o),c},f.setCountDownText=function(){var e=f.$("span.lbwidget-countdown");if(0===e.length)return clearInterval(f.countDownInterval),!1;for(var t=0;t<e.length;t++){var o=f.$(e[t]),i=""!==o.data("tpl")?o.data("tpl"):null,a=""!==o.data("expire")?o.data("expire"):null,n=""!==o.data("format")?o.data("format"):null,i=f.prepareCountDownText(o,i,a,n);o.html(i)}},f.parseWidgetText=function(e){for(var t=e.find(".lb-parse-text"),o=0;o<t.length;o++){var i=f.$(t[o]),a=i.html();"string"==typeof a&&(i.hasClass("lb-parse-inline")&&(a=f.parseInlineTemplates(a)),a=f.parseMacros(a),a=f.parseCountDownMacros(a),i.html(a))}},f.getReplacedTags=function(){return f.replacedTags},f.parseInlineTemplates=function(e){if(f.checkCanReplaceMacro(e)){var t=[],o=e.match(/\[\#([^\#\|\]]+)\]/gm);null!==o&&(t=o);for(var i=0,a=(t=null!==(o=e.match(/\[\#([^\#\|\]]+)\|([^\]]+)\]/gm))?t.concat(o):t).length;i<a;i++){var n=[],n=0<t[i].indexOf("|")?t[i].replace(/[\[\]]/g,"").split("|"):[t[i].replace(/[\[\]]/g,""),""],l=f.$(n[0]);0<l.length&&""!=f.$.trim(l.text())?(e=e.replace(t[i],l.text()),f.replacedTags[n[0].replace("#","")]=l.text()):(e=e.replace(t[i],n[1]),f.replacedTags[n[0].replace("#","")]=n[1])}}return e},f.widgetIsShow=function(e){return(f.isMobile()?e.find(".lb_mobile-wrapper"):e.find("#lb_widget-wrapper")).is(":visible")},f.showEula=function(e){f.$("#lb_eula_widget-wrapper").show(),f.$("#lb_eula--frame").attr("src",e)},f.hideEula=function(){f.$("#lb_eula_widget-wrapper").hide(),f.isMobile()||f.$("#lb_phone").focus()},f.callTo=function(t,o){f.log("callTo"),f.sendEvent("before_call");var e=t.find("#lb_phone").val();if(!1!==(e=f.checkPhone(e))){if(t.find("#lb_phone").removeClass("lb_error"),f.log("self.W.personal_agreement",f.W.personal_agreement,f.W.personal_agreement_markup),f.W.personal_agreement){var i=void 0!==f.W.personal_agreement_markup&&f.W.personal_agreement_markup,a=t.find("#lb_eula_checked"),n=(f.log("eula_checked",a,a.is(":checked")),!1),n=!a.length&&i&&!(a=t.find("div.lb_eula-container").find('input[type="checkbox"]')).length||a.is(":checked");if(f.log("eula_checked",n),!n)return t.find("#lb_eula_warning").show(),void a.closest(".lb_eula-container").addClass("lb_error");t.find("#lb_eula_warning").hide(),a.closest(".lb_eula-container").removeClass("lb_error")}f.sendGoal("LEADBACK_CALL",o),void 0!==f.W.hide_call_timer&&f.W.hide_call_timer?t.find(".lb_show_when_calling").hide():(f.startTimer(t),t.find(".lb_show_when_calling").show()),t.find(".lb_hide_when_calling").hide(),t.find("#lb_send").off("click"),t.find("#lb_button_call_success").off("click").on("click",function(){f.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_button_call_success--department").off("click").on("click",function(){f.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_widget-scheduler--controls").hide();var l,r,i="",n=(!0===(!f.W.active&&"use_holidays"===f.W.active_changed||t.find("#lb_widget-scheduler").data("opened"))&&(i=t.find("#lb_widget-scheduler--days").val()+" "+t.find("#lb_widget-scheduler--times").val()),""),a="",s=!f.storage.localStorage.isEmpty("departments"),c="";return"object"==typeof o&&(void 0!==o.delayed&&(i=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(o.delayed)?o.delayed:(r=["00","0",""],(l=new Date).setSeconds(l.getSeconds()+parseInt(o.delayed,10)),l.getFullYear()+"-"+(r[new String(l.getMonth()+1).length]+new String(l.getMonth()+1))+"-"+(r[new String(l.getDate()).length]+new String(l.getDate()))+" "+(r[new String(l.getHours()).length]+new String(l.getHours()))+":"+(r[new String(l.getMinutes()).length]+new String(l.getMinutes()))+":"+(r[new String(l.getSeconds()).length]+new String(l.getSeconds()))),f.log("SET delayed_time",i)),void 0!==o.label&&(n=o.label),void 0!==o.initiator&&(a=o.initiator),s)&&void 0!==o.department&&(c=o.department),f.log("Department assigned",c),""===c&&s&&(c=t.find('#lb_widget-department--items input[name="lb_widget-department--value"]:checked').val()),f.$.ajax({type:"GET",async:!0,url:f.PUBLIC_SERVER+"backend/widget_call.php",data:{site:window.location.host,phone:e,widget_key:f.W.widget_key,user_id:f.W.user_id,delayed:i,tz:f.getTz(),guid:f.getCookie(f.cg).guid,calltouch:window.calltouch_phone||window.calltouch_phone_1||window.calltouch_phone_2||"",department:c,label:n,initiator:a,cache:Math.random()},success:function(e){return f.setCookie(f.cg,{guid:f.getCookie(f.cg).guid,converted:!0},{path:"/",expires:99999}),"delayed"==e.result?(f.stopTimer(t),t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_delay-date").text(e.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),t.find(".lb_delay-time").text(e.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1")),t.find("#lb_close").on("click",function(){t.hide(),f.isMobile()&&f.mobileAdoptation()})):f.isMobile()&&"success"==e.result?(t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_message_title--delayed").hide(),t.find(".lb_message_title--success").show(),t.find("#lb_close").on("click",function(){t.hide(),f.isMobile()&&f.mobileAdoptation()})):"notice"!==e.result&&"empty_list"!==e.result||f.showNotice(t,e),void 0===f.W.hide_call_timer||!f.W.hide_call_timer||"success"!==e.result&&"delayed"!==e.result||f.showNotice(t,e),"success"!=e.result&&"delayed"!=e.result&&"notice"!=e.result&&"empty_list"!==e.result||"delayed"===e.result&&e.exists||f.sendEvent("call"),"function"==typeof f.successCallCallback&&(e.params=o,f.successCallCallback(e)),void 0!==f.Chat.widget_key&&void 0!==e.data&&void 0!==e.data.callback_phone&&""!=e.data.callback_phone&&f.Chat.sendEvent("set_profile",{profile:{phone:e.data.callback_phone}}),f.log("Call Success")},error:function(){return f.log("Call Error!")},dataType:"jsonp",jsonpCallback:"jsonpCallCallback"})}t.find("#lb_phone").addClass("lb_error")},f.showNotice=function(e,t){e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),t.time&&""!==t.time?(e.find(".lb_delay-date").text(t.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(t.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1"))):(e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show()),e.find("#lb_close").on("click",function(){e.hide(),f.isMobile()&&f.mobileAdoptation()})},f.startTimer=function(t){f.log("startTimer"),f.interval=setInterval(function(){var e=f.timer-46;e<=0&&(e=0,clearInterval(f.interval)),f.timer=e,f.timerHtml(t)},46)},f.stopTimer=function(e){f.log("stopTimer"),clearInterval(f.interval)},f.timerHtml=function(e){var t=Math.floor(f.timer/1e3).toString(),o=Math.round((f.timer-1e3*t)/10).toString();t=t.length<2?"0"+t:t,o=o.length<2?"0"+o:2<o.length?"00":o,e.find("#lb_timer_result").text("0:"+t+","+o)},f.sendEvent=function(e,t){return f.log("sendEvent",e,t),f.$.ajax({type:"GET",async:!0,url:f.PUBLIC_SERVER+"backend/widget_event.php",data:{type:e,widget_key:f.W.widget_key,user_id:f.W.user_id,guid:f.getCookie(f.cg).guid,ga_cid:f.getGoogleCid(),ya_cid:f.ya_cid,ya_counter:f.ya_counter,roistat:f.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:f.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(){return f.log("Event Stat ["+e+"] Success")},error:function(){return f.log("Event Stat ["+e+"] Error!")},dataType:"jsonp",jsonpCallback:"jsonpEventCallback_"+e})},f.getComagicSessionId=function(){return window.Comagic&&"function"==typeof window.Comagic.getSessionId?(f.log("!!! Getting comagic",window.Comagic,window.Comagic.getSessionId()),window.Comagic.getSessionId()):""},f.analytics=function(e){return f.log("sendAnalytics",e),f.$.ajax({type:"GET",async:!0,url:f.PUBLIC_SERVER+"backend/widget_analytics.php",data:{data:e,cache:Math.random()},success:function(){},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpAnalyticsCallback"})},f.sendGoal=function(e,t){f.log("Call sendGoal");var t=f.Events._callEvent("onGoalEvent",{goal:e,params:t});if(!1!==t){if(f.log("Send GOAL GA:"+e),"function"==typeof ga&&(ga("send","event",e,"clicked"),ga("ldbckTracker.send","event",e,"clicked")),"function"==typeof gtag&&gtag("event",e,{event_category:e,event_action:"clicked"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e}),0<f.ya.length)for(var o=f.ya.length-1;0<=o;o--)f.log("Send GOAL YA("+f.ya[o]+"):"+e),window[f.ya[o]].reachGoal(e);"LEADBACK_CALL"==e&&""!=f.W.facebook_pixel_event&&(f.log("track fb event "+f.W.facebook_pixel_event),""!=f.W.facebook_pixel_id?(t='<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id='+encodeURIComponent(f.W.facebook_pixel_id)+"&ev="+encodeURIComponent(f.W.facebook_pixel_event)+'&noscript=1"/>',f.log("nonscript pixel"),f.$("body").append(t)):"function"==typeof fbq?fbq("track",f.W.facebook_pixel_event):f.log("need pixel ID"))}},f.getPhonePrefix=function(){var e,t={ru:"+7",ua:"+380",by:"+375",kz:"+77",ge:"+995"},o="";for(e in void 0!==f.W&&(o=f.W.country),t)if(e==o)return t[o];return""},f.getTz=function(){return-(new Date).getTimezoneOffset()/60},f.load_jQuery=function(){f.log("load_jQuery");var e,t={jquery:"none",widget:_emv.campaign};return void 0!==window.jQuery&&(f.log("Site use jquery "+window.jQuery.fn.jquery),t.jquery=window.jQuery.fn.jquery),void 0!==window.jQuery&&(e=window.jQuery.fn.jquery,0<=inArray.call(f.JQUERY_VERSIONS,e))?(f.log("jQuery "+jQuery.fn.jquery+" is present and meets our requirements."),f.$=window.jQuery,f.init(),f.analytics(t)):(f.log("jQuery is not present."),f.getScript(f.JQUERY_URL,function(){if("undefined"!=typeof jQuery)return f.$=jQuery.noConflict(!0),f.log("jQuery version "+f.$.fn.jquery+" successfully loaded."),f.init(),f.analytics(t)}))},f.getScript=function(e,t){var o,i,a;return f.log("getScript",e),(a=document.createElement("script")).src=e,i=document.getElementsByTagName("head")[0],o=!1,a.onload=a.onreadystatechange=function(){if(!(o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))return o=!0,t(),a.onload=a.onreadystatechange=null,i.removeChild(a)},i.appendChild(a)},f.loadScript=function(e,t,o){var i,a,n,l;return f.log("loadScript",e),a=!1,n=null,(i=f.$).isFunction(t)?(n=t,a=o||a):(a=t||a,n=o||n),l=!0,i('script[type="text/javascript"]').each(function(){return l=e!==i(this).attr("src")}),l?i.ajax({type:"GET",url:e,success:n,dataType:"script",cache:a}):i.isFunction(n)?n.call(this):void 0},f.generateUUID=function(){var o,e;return f.log("generateUUID"),o=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:7&t|8).toString(16)}),f.sendUUID(e),e},f.sendUUID=function(e){f.log("sendUUID",e,_emv.campaign),f.$.ajax({type:"GET",url:f.PUBLIC_SERVER+"backend/widget_uuid.php",dataType:"json",data:{widget_key:_emv.campaign,uuid:e,ga_cid:f.getGoogleCid(),ya_cid:f.ya_cid,ya_counter:f.ya_counter,roistat:f.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:f.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(e){f.log("UUID",e)},error:function(){f.log("UUID error")},dataType:"jsonp",jsonpCallback:"jsonpUuidCallback"})},f.isMobile=function(){return!f.is_vk&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))},f.isIpad=function(){return/ipad/i.test(navigator.userAgent||navigator.vendor||window.opera)},f.isIOS=function(){return/ip(hone|od|ad)/i.test(navigator.userAgent||navigator.vendor||window.opera)},f.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints||window.DocumentTouch&&document instanceof DocumentTouch},f.mobileButton=function(e,t){f.log("call mobileButton");var o=80/f.screen_width,o=window.innerWidth*o,i=window.innerWidth/2-.5*o+window.pageXOffset,a=window.innerHeight-1.25*o+window.pageYOffset,i=(null!==e&&(e.css("width",o),e.css("height",o),e.css("left",i),e.css("top",a),e.find("object").css("width",o),e.find("img").css("width",o)),t.css("width",f.screen_width+"px"),t.css("height",f.screen_height+"px"),f.screen_width/window.innerWidth);t.css("zoom",1/i),t.css("top",window.pageYOffset*i),t.css("left",window.pageXOffset*i)},f.default_viewport=null,f.default_viewport_is_mobile=!1,f.mobileAdoptation=function(){if(f.$("html").hasClass("lb-site-hide"))f.$("html").removeClass("lb-site-hide"),!1===f.default_viewport?f.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.33"):f.default_viewport&&f.$("meta[name=viewport]").attr("content",f.default_viewport),(e=f.$("html").data("ldbck_save_scroll"))&&f.$(document).scrollTop(e);else{var e=f.$(document).scrollTop();if(f.$("html").data("ldbck_save_scroll",e),f.$("html").addClass("lb-site-hide"),0==f.$("meta[name=viewport]").length)f.default_viewport=!1,f.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">');else if(null===f.default_viewport){f.default_viewport=f.$("meta[name=viewport]").attr("content");for(var t,o=f.default_viewport.split(","),i=!1,a=0;a<o.length;a++){o[a]=o[a].replace(/^\s+/,"");var n=o[a].split("=");"initial-scale"==n[0]&&(t=n[1]),"maximum-scale"==n[0]&&(i=n[1])}if(1==t&&1==i)return void(f.default_viewport_is_mobile=!0);f.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}else f.default_viewport_is_mobile||f.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}var l;"1"!=f.W.chat&&(e=f.$("#lb_mobile-call"),l=f.$(".lb_mobile-wrapper"),e)&&l&&f.mobileButton(e,l)},f.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},f.randomVal=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},f.log=function(e){var t;f.debug_window&&((t=document.getElementById("ldbck_debug_window"))||((t=document.createElement("div")).id="ldbck_debug_window",t.style="position: absolute; top: 0; left: 0; width: 100%; background-color: rgba(0,0,0,.2); color: white; z-index:9999;",document.body.appendChild(t)),document.getElementById("ldbck_debug_window").innerHTML+="<div>"+e+": "+JSON.stringify(arguments)+"</div>"),!ldbck.DEBUG&&"#debug"!=window.location.hash||((t=Array.prototype.slice.call(arguments)).unshift((new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" "),console.log.apply(console,t))},f.initStorage=function(e){function r(e){var t,o,i,a=arguments.length,n=window[e],l=arguments,r=l[1];if(a<2)throw new Error("Minimum 2 arguments must be given");if(g.isArray(r)){for(var s in o={},r){t=r[s];try{o[t]=JSON.parse(n.getItem(t))}catch(e){o[t]=n.getItem(t)}}return o}if(2!=a){try{o=JSON.parse(n.getItem(r))}catch(e){throw new ReferenceError(r+" is not defined in this storage")}for(s=2;s<a-1;s++)if(void 0===(o=o[l[s]]))throw new ReferenceError([].slice.call(l,1,s+1).join(".")+" is not defined in this storage");if(g.isArray(l[s])){for(var c in i=o,o={},l[s])o[l[s][c]]=i[l[s][c]];return o}return o[l[s]]}try{return JSON.parse(n.getItem(r))}catch(e){return n.getItem(r)}}function a(e){var t,o=arguments.length,i=window[e],a=arguments,n=a[1],e=a[2],l={};if(o<2||!g.isPlainObject(n)&&o<3)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");if(g.isPlainObject(n)){for(var r in n)t=n[r],g.isPlainObject(t)?i.setItem(r,JSON.stringify(t)):i.setItem(r,t);return n}if(3==o)return"object"==typeof e?i.setItem(n,JSON.stringify(e)):i.setItem(n,e),e;try{null!=(s=i.getItem(n))&&(l=JSON.parse(s))}catch(e){}for(var s=l,r=2;r<o-2;r++)s[t=a[r]]&&g.isPlainObject(s[t])||(s[t]={}),s=s[t];return s[a[r]]=a[r+1],i.setItem(n,JSON.stringify(l)),l}function n(e){var t,o,i=arguments.length,a=window[e],n=arguments,l=n[1];if(i<2)throw new Error("Minimum 2 arguments must be given");if(g.isArray(l))for(var r in l)a.removeItem(l[r]);else if(2==i)a.removeItem(l);else{try{t=o=JSON.parse(a.getItem(l))}catch(e){throw new ReferenceError(l+" is not defined in this storage")}for(r=2;r<i-1;r++)if(void 0===(o=o[n[r]]))throw new ReferenceError([].slice.call(n,1,r).join(".")+" is not defined in this storage");if(g.isArray(n[r]))for(var s in n[r])delete o[n[r][s]];else delete o[n[r]];a.setItem(l,JSON.stringify(t))}return!0}function l(e){var t=arguments.length,o=arguments,i=(window[e],o[1]);if(1==t)return 0==c(e).length;if(g.isArray(i)){for(var a=0;a<i.length;a++)if(!l(e,i[a]))return!1;return!0}try{var n=r.apply(this,arguments);for(a in n=g.isArray(o[t-1])?n:{totest:n})if(!(g.isPlainObject(n[a])&&g.isEmptyObject(n[a])||g.isArray(n[a])&&!n[a].length)&&n[a])return!1;return!0}catch(e){return!0}}function s(e){var t=arguments.length,o=arguments,i=(window[e],o[1]);if(t<2)throw new Error("Minimum 2 arguments must be given");if(g.isArray(i)){for(var a=0;a<i.length;a++)if(!s(e,i[a]))return!1;return!0}try{var n=r.apply(this,arguments);for(a in n=g.isArray(o[t-1])?n:{totest:n})if(null==n[a])return!1;return!0}catch(e){return!1}}function c(e){var t=arguments.length,e=window[e],o=arguments,i=[],a={};if((a=1<t?r.apply(this,o):e)&&a._cookie)for(var n in g.cookie())""!=n&&i.push(n.replace(a._prefix,""));else for(var l in a)i.push(l);return i}function d(e){if(!e||"string"!=typeof e)throw new Error("First parameter must be a string");o?(window.localStorage.getItem(e)||window.localStorage.setItem(e,"{}"),window.sessionStorage.getItem(e)||window.sessionStorage.setItem(e,"{}")):(window.localCookieStorage.getItem(e)||window.localCookieStorage.setItem(e,"{}"),window.sessionCookieStorage.getItem(e)||window.sessionCookieStorage.setItem(e,"{}"));var t={localStorage:g.extend({},g.localStorage,{_ns:e}),sessionStorage:g.extend({},g.sessionStorage,{_ns:e})};return g.namespaceStorages[e]=t}var g,o,t;return g=f.$,o=(e=>{var t="jsapi";try{return window[e]?(window[e].setItem(t,t),window[e].removeItem(t),!0):!1}catch(e){return!1}})("localStorage"),t={_type:"",_ns:"",_callMethod:function(e,t){var o=[this._type],i=(t=Array.prototype.slice.call(t))[0];return this._ns&&o.push(this._ns),"string"==typeof i&&-1!==i.indexOf(".")&&(t.shift(),[].unshift.apply(t,i.split("."))),[].push.apply(o,t),e.apply(this,o)},get:function(){return this._callMethod(r,arguments)},set:function(){var e=arguments.length,t=arguments,o=t[0];if(e<1||!g.isPlainObject(o)&&e<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(g.isPlainObject(o)&&this._ns){for(var i in o)a(this._type,this._ns,i,o[i]);return o}return e=this._callMethod(a,t),this._ns?e[o.split(".")[0]]:e},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(n,arguments)},removeAll:function(e){if(this._ns)return a(this._type,this._ns,{}),!0;var t=this._type,o=c(t);for(i in o)n(t,o[i]);if(e)for(var i in g.namespaceStorages)d(i)},isEmpty:function(){return this._callMethod(l,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},keys:function(){return this._callMethod(c,arguments)}},g.initNamespaceStorage=d,o?(g.localStorage=g.extend({},t,{_type:"localStorage"}),g.sessionStorage=g.extend({},t,{_type:"sessionStorage"})):(g.localStorage=g.extend({},t,{_type:"localCookieStorage"}),g.sessionStorage=g.extend({},t,{_type:"sessionCookieStorage"})),g.namespaceStorages={},g.removeAllStorages=function(e){g.localStorage.removeAll(e),g.sessionStorage.removeAll(e),g.cookieStorage&&g.cookieStorage.removeAll(e),e||(g.namespaceStorages={})},f.$.initNamespaceStorage("__"+e)},f.coBrowseV2=function(i){f.log("coBrowseV2"),Cloudim.Api.getCurrentOperator(function(o){!1!==o&&void 0===o.length&&Cloudim.Api.getVisitor(function(e){var t=f.$("html").clone(),e=(t.find("script").attr("src","").html(""),t.find(".app-cobrowsing").remove(),t.find("#lb_widget-root").html(""),t.find("audio").html(""),t.find("iframe#cloudim_chat").html(""),{widget_key:f.W.widget_key,user_id:f.W.user_id,guid:f.getCookie(f.cg).guid,loc:document.location.href,operator:o.jid,visitor:e.jid,html:t.html()});f.$.post(f.PUBLIC_SERVER+"backend/widget_cobrowse.php",e,function(e){"function"==typeof i&&i(e)},"json")})})},f.Cookies=function e(h){function _(e,t,o){var i,a;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(o=m({path:"/"},_.defaults,o)).expires&&((a=new Date).setMilliseconds(a.getMilliseconds()+864e5*o.expires),o.expires=a),o.expires=o.expires?o.expires.toUTCString():"";try{i=JSON.stringify(t),/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=h.write?h.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var n,l="";for(n in o)o[n]&&(l+="; "+n,!0!==o[n])&&(l+="="+o[n]);return document.cookie=e+"="+t+l}e||(i={});for(var r=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,c=0;c<r.length;c++){var d=r[c].split("="),g=d.slice(1).join("=");this.json||'"'!==g.charAt(0)||(g=g.slice(1,-1));try{var u=d[0].replace(s,decodeURIComponent),g=h.read?h.read(g,u):h(g,u)||g.replace(s,decodeURIComponent);if(this.json)try{g=JSON.parse(g)}catch(e){}if(e===u){i=g;break}e||(i[u]=g)}catch(e){}}return i}}return(_.set=_).get=function(e){return _.call(_,e)},_.getJSON=function(){return _.apply({json:!0},[].slice.call(arguments))},_.defaults={},_.remove=function(e,t){_(e,"",m(t,{expires:-1}))},_.withConverter=e,_}(function(){}),f.Events={onChatReady:[],onGoalEvent:[],_callEvent:function(e,t){var o=!0;if(void 0!==f.Events[e]&&0<f.Events[e].length)for(var i in f.Events[e])!1===f.Events[e][i](t)&&(o=!1);return o}},f.Api={callTo:function(e,t){t=t&&"object"!=typeof t?{delayed:t}:t;f.$("#lb_phone").val(e),f.callTo(f.$("#lb_widget-root"),t)},callFromForm:function(e,t){f.$("#lb_phone").val(e);e={initiator:"magic_forms"};t&&"string"==typeof t&&""!==f.$.trim(t)&&(e.label=t),f.callTo(f.$("#lb_widget-root"),e)},bind:function(e,t){f.Events[e]&&(f.Events[e][f.Events[e].length]=t)}},0<f.onApiReady.length)for(a=0,n=f.onApiReady.length;a<n;a++)"function"==typeof f.onApiReady[a]&&f.onApiReady[a](f.Api);"object"==typeof window.Muse&&"function"==typeof window.muse_init?(f.log("Is Muse site"),f.muse_detect_interval=null,f.muse_interval=150,f.muse_stop_check=5e3,f.muse_step=0,f.muse_detect_interval=setInterval(function(){f.muse_step++,(!0===document.body.classList.contains("initialized")||f.muse_step>=f.muse_stop_check/f.muse_interval)&&(f.log("Muse Is initialized"),clearInterval(f.muse_detect_interval),f.muse_detect_interval=null,f.load_jQuery())},f.muse_interval)):f.load_jQuery()}.call(this);